<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Detalhes da OS | Gestão Profissional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .main-layout { display: flex; min-height: 100vh; }
        .content-wrapper { flex-grow: 1; padding: 2rem; overflow-y: auto; }
        .details-card .card-header { font-size: 1.25rem; }
        .details-card .list-group-item { background-color: transparent; border: 0; padding-left: 0; padding-right: 0;}
    </style>
</head>
<body>
<div class="main-layout">
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    <div class="content-wrapper">
        <main>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0 fw-bold" th:text="'Ordem de Serviço #' + ${os.id}"></h1>
                <a th:href="@{/ordens-servico}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-2"></i>Voltar para a Lista</a>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card shadow-sm border-0 details-card">
                        <div class="card-header bg-white fw-bold">Serviços e Equipe</div>
                        <div class="card-body">
                            <h6>Serviços Executados</h6>
                            <table class="table table-sm">
                                <thead><tr><th>Serviço</th><th class="text-end">Valor</th></tr></thead>
                                <tbody>
                                <tr th:each="item : ${os.itens}">
                                    <td th:text="${item.servico.nome}"></td>
                                    <td class="text-end" th:text="${#numbers.formatCurrency(item.precoCobrado)}"></td>
                                </tr>
                                </tbody>
                            </table>
                            <hr>
                            <h6>Equipe Envolvida</h6>
                            <ul class="list-unstyled" th:if="${!os.funcionarios.isEmpty()}">
                                <li th:each="func : ${os.funcionarios}" th:text="${func.nome}"></li>
                            </ul>
                            <p th:if="${os.funcionarios.isEmpty()}" class="text-muted">Nenhum funcionário vinculado.</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow-sm border-0 details-card">
                        <div class="card-header bg-white fw-bold">Informações Gerais</div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between">
                                    <strong>Status:</strong>
                                    <span th:text="${os.status.descricao}" class="badge"
                                          th:classappend="${os.status.name() == 'PENDENTE' ? 'bg-secondary' : os.status.name() == 'EM_ANDAMENTO' ? 'bg-primary' : os.status.name() == 'FINALIZADA' ? 'bg-success' : 'bg-danger'}"></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between">
                                    <strong>Pagamento:</strong>
                                    <span th:if="${os.contaReceber == null}" class="badge bg-light text-dark">N/A</span>
                                    <span th:if="${os.contaReceber?.status.name() == 'PENDENTE'}" class="badge bg-warning">Aguardando</span>
                                    <span th:if="${os.contaReceber?.status.name() == 'RECEBIDA'}" class="badge bg-success">Pago</span>
                                    <span th:if="${os.contaReceber?.status.name() == 'CANCELADA'}" class="badge bg-secondary">Cancelado</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between">
                                    <strong>Valor Total:</strong>
                                    <span class="fw-bold text-success" th:text="${#numbers.formatCurrency(os.valorTotal)}"></span>
                                </li>
                                <li class="list-group-item">
                                    <strong>Cliente:</strong>
                                    <span class="d-block" th:text="${os.cliente.nome}"></span>
                                </li>
                                <li class="list-group-item">
                                    <strong>Veículo:</strong>
                                    <span class="d-block" th:text="${os.veiculo.marca + ' ' + os.veiculo.modelo + ' (' + os.veiculo.placa + ')'}"></span>
                                </li>
                                <li class="list-group-item">
                                    <strong>Entrada:</strong>
                                    <span class="d-block" th:text="${#temporals.format(os.dataEntrada, 'dd/MM/yyyy HH:mm')}"></span>
                                </li>
                                <li class="list-group-item" th:if="${os.dataFinalizacao != null}">
                                    <strong>Finalização:</strong>
                                    <span class="d-block" th:text="${#temporals.format(os.dataFinalizacao, 'dd/MM/yyyy HH:mm')}"></span>
                                </li>
                                <li class="list-group-item" th:if="${os.observacoes != null and !os.observacoes.isEmpty()}">
                                    <strong>Observações:</strong>
                                    <p class="mb-0 small" th:text="${os.observacoes}"></p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>